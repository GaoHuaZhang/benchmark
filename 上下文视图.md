分析 AISBench 的上下文视图，梳理系统与外部实体的交互关系。


[7 tools called]


绘制 AISBench 的上下文视图，并描述系统与外部实体的交互关系。


[1 tool called]


## AISBench 上下文视图

### 上下文视图图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                        用户 (User)                                │   │
│  │  • 通过命令行接口 (CLI) 提交评测任务                              │   │
│  │  • 通过配置文件定义评测任务                                       │   │
│  │  • 查看评测结果和日志                                             │   │
│  └───────────────────────┬────────────────────────────────────────────┘   │
│                          │                                                 │
│                          │ 提交任务/查看结果                                │
│                          ▼                                                 │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                    AISBench 评测系统                              │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │   │
│  │  │  任务管理    │  │  模型适配器   │  │  数据集管理   │          │   │
│  │  │  (Tasks)    │  │  (Models)    │  │  (Datasets)   │          │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │   │
│  │  │  运行器      │  │  结果汇总     │  │  监控系统     │          │   │
│  │  │  (Runners)   │  │  (Summarizer)│  │  (Monitor)    │          │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │   │
│  └─────┬──────────┬──────────┬──────────┬──────────┬──────────────┘   │
│        │          │          │          │          │                    │
│        │          │          │          │          │                    │
│        │          │          │          │          │                    │
└────────┼──────────┼──────────┼──────────┼──────────┼────────────────────┘
         │          │          │          │          │
         │          │          │          │          │
    ┌────▼────┐ ┌──▼──┐  ┌────▼────┐ ┌──▼──┐  ┌────▼────┐
    │ 推理服务 │ │本地 │  │ 数据集  │ │Open │  │ 外部库  │
    │ 后端    │ │模型 │  │ 存储    │ │Compass│ │         │
    └─────────┘ └─────┘  └─────────┘ └──────┘ └─────────┘
         │          │          │          │          │
    ┌────┴────┐ ┌──┴──┐  ┌────┴────┐ ┌──┴──┐  ┌────┴────┐
    │ vLLM    │ │Hugging│ │ 本地    │ │配置 │  │transform│
    │ Triton  │ │Face   │ │ 数据集  │ │体系 │  │ers      │
    │ TGI     │ │模型   │ │ OpenCom │ │数据 │  │vllm     │
    │ MindIE  │ │仓库   │ │ pass    │ │集结 │  │aiohttp  │
    │ SGLang  │ │       │ │ 数据集  │ │构   │  │requests │
    └─────────┘ └───────┘ └─────────┘ └─────┘ └─────────┘
```

### 详细描述

#### 1. 用户交互层

- 用户角色：评测工程师、研究人员、开发者
- 交互方式：
  - 命令行接口（CLI）：通过 `ais_bench` 命令提交任务
  - 配置文件：Python 配置文件定义任务组合
  - 结果查看：查看评测结果、日志、可视化报告

#### 2. 推理服务后端（服务化模式）

- vLLM 服务
  - 接口：`v1/completions`、`v1/chat/completions`
  - 协议：HTTP/HTTPS
  - 交互：异步 HTTP 请求（aiohttp）
- Triton 推理服务
  - 接口：`v2/models/{model}/generate`
  - 协议：HTTP
- TGI（Text Generation Inference）
  - 接口：`generate`、`generate_stream`
- MindIE 服务
  - 接口：`infer`（流式）
- SGLang 服务
  - 接口：兼容 OpenAI API

#### 3. 本地模型存储（本地模式）

- HuggingFace 模型仓库
  - 来源：HuggingFace Hub 或本地路径
  - 加载：`transformers.AutoModel.from_pretrained()`
  - 支持：Base 模型、Chat 模型、多模态模型
- 本地模型文件
  - 存储：本地文件系统
  - 格式：PyTorch、Safetensors 等

#### 4. 数据集存储

- 本地数据集
  - 位置：`ais_bench/datasets/`
  - 格式：JSON、JSONL、CSV 等
  - 来源：用户下载或自定义
- OpenCompass 数据集
  - 兼容：OpenCompass 数据集结构
  - 来源：OpenCompass 生态

#### 5. OpenCompass 兼容层

- 配置体系：兼容 OpenCompass 配置格式
- 数据集结构：兼容 OpenCompass 数据集接口
- 模型后端：复用部分 OpenCompass 模型实现

#### 6. 外部依赖库

- 核心库
  - `transformers`：HuggingFace 模型加载
  - `vllm`：vLLM 离线推理
  - `aiohttp` / `requests`：HTTP 客户端
  - `mmengine`：配置管理
- 可选库
  - `torch`：PyTorch
  - `numpy`：数值计算
  - 其他评估库（如 `bfcl_eval`）

### 数据流向

#### 精度评测流程
```
用户命令 → AISBench系统 → 读取数据集 → 发送推理请求 → 推理服务/本地模型
                                                              ↓
用户结果 ← 结果汇总 ← 精度计算 ← 收集推理结果 ← 接收响应
```

#### 性能评测流程
```
用户命令 → AISBench系统 → 生成/读取测试数据 → 流式请求 → 推理服务
                                                              ↓
用户结果 ← 结果汇总 ← 性能指标计算 ← 时间戳记录 ← 流式响应
```

### 关键交互协议

1. HTTP/HTTPS：与服务化推理后端通信
2. 文件系统：读取数据集、保存结果
3. Python API：加载本地模型（transformers、vllm）
4. 配置协议：基于 Python 的配置系统

### 系统边界

- 系统内：任务管理、模型适配、数据集管理、结果汇总、监控
- 系统外：推理服务、模型存储、数据集存储、用户、外部库

### 依赖关系

- 强依赖：推理服务（服务化模式）、数据集文件、Python 环境
- 弱依赖：OpenCompass（兼容）、外部评估库（可选功能）

该上下文视图展示了 AISBench 作为评测工具，与外部推理服务、模型存储、数据集和用户之间的交互关系，支持服务化和本地两种评测模式。